version: "3.8"
services:
  api:
    build: .
    container_name: maternity-api
    env_file: env.example
    ports:
      - "${API_PORT:-8000}:8000"
    volumes:
      - ./data:/app/data
      - ./config:/app/config
      - ./backend:/app/backend
      - ./reports:/app/reports
    command: uvicorn backend.api.main:app --host 0.0.0.0 --port ${API_PORT:-8000}
    restart: unless-stopped
  orchestrator:
    build: .
    container_name: maternity-orchestrator
    profiles: ["orchestrator"]
    env_file: env.example
    volumes:
      - ./data:/app/data
      - ./config:/app/config
      - ./backend:/app/backend
      - ./reports:/app/reports
    command: python scripts/run_orchestrator.py --snapshot ${SNAPSHOT:-202512}
    restart: "no"
